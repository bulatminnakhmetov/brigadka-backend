asyncapi: '2.6.0'
info:
  title: Brigadka Chat WebSocket API
  version: '1.0.0'
  description: WebSocket API for real-time messaging in Brigadka application

servers:
  production:
    url: wss://api.brigadka.com/ws
    protocol: wss
    description: Production WebSocket server
  development:
    url: ws://localhost:8080/ws
    protocol: ws
    description: Development WebSocket server

channels:
  /:
    publish:
      summary: Client publishes messages to server
      operationId: sendMessage
      message:
        oneOf:
          - $ref: '#/components/messages/ChatMessage'
          - $ref: '#/components/messages/JoinMessage'
          - $ref: '#/components/messages/LeaveMessage'
          - $ref: '#/components/messages/ReactionMessage'
          - $ref: '#/components/messages/TypingMessage'
          - $ref: '#/components/messages/ReadReceiptMessage'
    subscribe:
      summary: Client receives messages from server
      operationId: receiveMessage
      message:
        oneOf:
          - $ref: '#/components/messages/ChatMessage'
          - $ref: '#/components/messages/JoinNotification'
          - $ref: '#/components/messages/LeaveNotification'
          - $ref: '#/components/messages/ReactionNotification'
          - $ref: '#/components/messages/TypingNotification'
          - $ref: '#/components/messages/ReadReceiptNotification'

components:
  messages:
    ChatMessage:
      name: ChatMessage
      title: Chat Message
      summary: Message sent in a chat
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    JoinMessage:
      name: JoinMessage
      title: Join Chat Request
      summary: Request to join a chat room
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    LeaveMessage:
      name: LeaveMessage
      title: Leave Chat Request
      summary: Request to leave a chat room
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    ReactionMessage:
      name: ReactionMessage
      title: Add Reaction Request
      summary: Request to add a reaction to a message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    TypingMessage:
      name: TypingMessage
      title: Typing Indicator
      summary: Indicates user is typing
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    ReadReceiptMessage:
      name: ReadReceiptMessage
      title: Read Receipt
      summary: Indicates a message has been read
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    JoinNotification:
      name: JoinNotification
      title: User Joined Chat
      summary: Notification that a user has joined the chat
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    LeaveNotification:
      name: LeaveNotification
      title: User Left Chat
      summary: Notification that a user has left the chat
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    ReactionNotification:
      name: ReactionNotification
      title: Message Reaction
      summary: Notification of a reaction to a message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    TypingNotification:
      name: TypingNotification
      title: User Typing
      summary: Notification that a user is typing
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'
        
    ReadReceiptNotification:
      name: ReadReceiptNotification
      title: Message Read
      summary: Notification that a message has been read
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WSMessage'

  schemas:
    WSMessage:
      type: object
      required:
        - type
        - chat_id
        - payload
      properties:
        type:
          type: string
          enum:
            - chat
            - join
            - leave
            - reaction
            - typing
            - read_receipt
          description: Type of the message
        chat_id:
          type: string
          description: ID of the chat room
        payload:
          type: object
          description: Message payload (varies by message type)
          
    ChatMessagePayload:
      type: object
      required:
        - message_id
        - content
      properties:
        message_id:
          type: string
          format: uuid
          description: Unique ID for the message
        chat_id:
          type: string
          description: ID of the chat room
        sender_id:
          type: integer
          description: ID of the message sender
        content:
          type: string
          description: Message content
        sent_at:
          type: string
          format: date-time
          description: Timestamp when message was sent
          
    JoinNotificationPayload:
      type: object
      required:
        - user_id
        - chat_id
        - joined_at
      properties:
        user_id:
          type: integer
          description: ID of the user who joined
        chat_id:
          type: string
          description: ID of the chat room
        joined_at:
          type: string
          format: date-time
          description: Timestamp when user joined
          
    LeaveNotificationPayload:
      type: object
      required:
        - user_id
        - chat_id
        - left_at
      properties:
        user_id:
          type: integer
          description: ID of the user who left
        chat_id:
          type: string
          description: ID of the chat room
        left_at:
          type: string
          format: date-time
          description: Timestamp when user left
          
    ReactionPayload:
      type: object
      required:
        - reaction_id
        - message_id
        - user_id
        - reaction_code
      properties:
        reaction_id:
          type: string
          format: uuid
          description: Unique ID for the reaction
        message_id:
          type: string
          format: uuid
          description: ID of the message being reacted to
        user_id:
          type: integer
          description: ID of the user who reacted
        reaction_code:
          type: string
          description: Emoji code for the reaction
        reacted_at:
          type: string
          format: date-time
          description: Timestamp of the reaction
          
    TypingNotificationPayload:
      type: object
      required:
        - user_id
        - chat_id
        - is_typing
        - timestamp
      properties:
        user_id:
          type: integer
          description: ID of the user who is typing
        chat_id:
          type: string
          description: ID of the chat room
        is_typing:
          type: boolean
          description: Whether user is currently typing
        timestamp:
          type: string
          format: date-time
          description: Timestamp of typing event
          
    ReadReceiptPayload:
      type: object
      required:
        - message_id
      properties:
        message_id:
          type: string
          format: uuid
          description: ID of the message that was read
          
    ReadReceiptNotificationPayload:
      type: object
      required:
        - user_id
        - chat_id
        - message_id
        - read_at
      properties:
        user_id:
          type: integer
          description: ID of the user who read the message
        chat_id:
          type: string
          description: ID of the chat room
        message_id:
          type: string
          format: uuid
          description: ID of the message that was read
        read_at:
          type: string
          format: date-time
          description: Timestamp when message was read